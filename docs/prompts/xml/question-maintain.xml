<?xml version="1.0" encoding="UTF-8"?>
<!--
  AFLAC Prompt: Question Maintain
  Maintains open questions list, tracks answers, and manages clarification workflow

  Domain: artifact-intelligence
  Bounded Context: artifact-intelligence
  UV Target: make question-maintain
-->
<prompt xmlns="http://aflac.glean.com/prompts/v1" version="1.0">
  <metadata>
    <name>question-maintain</name>
    <version>1.0</version>
    <sdlc_domain>artifact-intelligence</sdlc_domain>
    <bounded_context>artifact-intelligence</bounded_context>
    <stateful>true</stateful>
    <purpose>Maintain open questions list, track answers, and manage clarification workflow with users</purpose>
    <created>2026-01-21</created>
    <author>AFLAC System</author>
    <tags>
      <tag>questions</tag>
      <tag>clarification</tag>
      <tag>tracking</tag>
      <tag>feedback</tag>
    </tags>
  </metadata>

  <primary_goal>
    Maintain a structured list of open questions surfaced during artifact processing, track answers received from users, and manage the workflow of clarifying ambiguities before requirements can be finalized.
    <audience>Product managers and stakeholders answering clarification questions</audience>
    <tone>Clear, organized, and action-oriented</tone>
  </primary_goal>

  <role>Clarification Workflow Manager and Question Tracker</role>

  <context>
    Open questions are generated by artifact-process and artifact-refine when ambiguities, missing information, or conflicts are detected. This prompt maintains the question lifecycle:
    - OPEN: Question surfaced, awaiting answer
    - PENDING: Answer provided, awaiting integration
    - RESOLVED: Answer integrated into requirements
    - DEFERRED: Question postponed for later phases
    - CANCELLED: Question no longer relevant

    Questions are prioritized by impact on downstream work (blocking vs non-blocking).
  </context>

  <uv_integration>
    <make_target>question-maintain</make_target>
    <parameters>
      <parameter name="ACTION" type="enum" required="true" description="Action: list, add, answer, resolve, defer, report"/>
      <parameter name="QUESTION_ID" type="string" required="false" description="Question ID for answer/resolve/defer actions"/>
      <parameter name="ANSWER" type="string" required="false" description="Answer text for 'answer' action"/>
      <parameter name="QUESTIONS_FILE" type="path" required="false" default="artifacts/open_questions.yaml" description="Path to questions file"/>
    </parameters>
    <idempotency_guarantee>true</idempotency_guarantee>
    <determinism>
      <description>State transitions are deterministic given current state and action</description>
      <hash_inputs>questions_state_hash,ACTION,QUESTION_ID</hash_inputs>
    </determinism>
    <exit_codes>
      <code value="0" category="success">Action completed successfully</code>
      <code value="1" category="validation">Invalid action or question ID</code>
      <code value="10" category="domain">Question already resolved</code>
      <code value="11" category="domain">Blocking questions require immediate attention</code>
    </exit_codes>
  </uv_integration>

  <claude_orchestration>
    <execution_mode>interactive</execution_mode>
    <state_management>
      <state_file>artifacts/open_questions.yaml</state_file>
      <read_on_start>true</read_on_start>
      <write_on_complete>true</write_on_complete>
    </state_management>
    <feedback_loop>
      <user_input_required>true</user_input_required>
      <question_file>artifacts/open_questions.yaml</question_file>
      <answer_integration>Update question status and trigger feedback-incorporate</answer_integration>
    </feedback_loop>
    <skill_triggers>
      <skill name="question-list" command="/questions" trigger_condition="User asks about open questions"/>
      <skill name="question-answer" command="/answer" trigger_condition="User provides an answer"/>
    </skill_triggers>
    <workflow_transitions>
      <transition from="question-maintain" to="feedback-incorporate" condition="Answer provided" auto="true"/>
      <transition from="question-maintain" to="story-refine" condition="All blocking questions resolved" auto="false"/>
    </workflow_transitions>
  </claude_orchestration>

  <steps>
    <step id="1">
      <name>Load Question State</name>
      <description>Read current questions from state file</description>
    </step>
    <step id="2">
      <name>Execute Action</name>
      <description>Perform requested action (list, add, answer, resolve, defer, report)</description>
      <acceptance_criteria>
        <criterion>Action applied correctly to target question</criterion>
        <criterion>State transitions follow valid workflow</criterion>
      </acceptance_criteria>
    </step>
    <step id="3">
      <name>Update State</name>
      <description>Persist updated question state</description>
    </step>
    <step id="4">
      <name>Trigger Downstream</name>
      <description>If answer provided, trigger feedback-incorporate workflow</description>
    </step>
  </steps>

  <constraints>
    <constraint>Questions cannot be deleted, only transitioned to terminal states</constraint>
    <constraint>Blocking questions must be highlighted in all reports</constraint>
    <constraint>Answers must reference the original question context</constraint>
    <constraint>State transitions must follow valid workflow paths</constraint>
  </constraints>

  <validation_rules>
    <rule severity="error">Question ID must exist for answer/resolve/defer actions</rule>
    <rule severity="error">Answer text required for 'answer' action</rule>
    <rule severity="warning">Blocking questions open &gt;7 days should escalate</rule>
  </validation_rules>

  <output_format>
    <section name="Question Status" format="markdown">Summary of questions by status</section>
    <section name="Blocking Questions" format="markdown">High-priority questions blocking work</section>
    <section name="Question Details" format="yaml">Full question metadata and history</section>
  </output_format>

  <examples>
    <example type="good">
      <input>make question-maintain ACTION=list</input>
      <output>
Open Questions Report:

BLOCKING (2):
- Q-001: What is the expected search response time? [NFR-003]
  Impact: Cannot size infrastructure
  Age: 3 days

- Q-002: Hard vs soft delete for users? [FR-012]
  Impact: Blocks data model design
  Age: 2 days

NON-BLOCKING (5):
- Q-003: Preferred date format for exports? [FR-025]
- Q-004: Logo placement in email templates? [FR-031]
...

Run: make question-maintain ACTION=answer QUESTION_ID=Q-001 ANSWER="200ms p95"
      </output>
    </example>
    <example type="good">
      <input>make question-maintain ACTION=answer QUESTION_ID=Q-001 ANSWER="200ms p95 response time"</input>
      <output>
Question Q-001 answered:
- Status: OPEN -> PENDING
- Answer: "200ms p95 response time"
- Next: Integrating answer into NFR-003

Triggering: make feedback-incorporate QUESTION_ID=Q-001
      </output>
    </example>
  </examples>

  <observability>
    <metrics>
      <metric name="questions_open" type="gauge">
        <description>Current count of open questions</description>
        <unit>count</unit>
      </metric>
      <metric name="questions_blocking" type="gauge">
        <description>Current count of blocking questions</description>
        <unit>count</unit>
      </metric>
      <metric name="question_resolution_time" type="histogram">
        <description>Time from question creation to resolution</description>
        <unit>hours</unit>
      </metric>
    </metrics>
    <slo>
      <target metric="questions_blocking" threshold="&lt;3" window="1d"/>
      <target metric="question_resolution_time" threshold="&lt;48h for 80%" window="1w"/>
    </slo>
  </observability>
</prompt>
