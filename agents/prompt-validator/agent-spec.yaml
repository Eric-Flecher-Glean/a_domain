agent_id: prompt-validator-001
agent_name: "Prompt Quality Validator"
version: 1.0.0
created: "2026-01-25"
status: active

description: |
  Validates XML-structured prompts against quality standards, checking
  structure, completeness, and effectiveness. Provides actionable feedback
  for refinement.

bounded_context: "PromptEngineering"

capabilities:
  - Parse and validate XML structure
  - Check tag hierarchy and nesting depth
  - Verify completeness of required sections
  - Calculate quality scores (0-100)
  - Generate actionable feedback
  - Compare against good/bad example patterns
  - Track validation across multiple attempts
  - Validate input specifications and context requirements (NEW)
  - Verify Glean integration specifications (NEW)

input_contract:
  xml_prompt:
    type: string
    required: true
    description: "XML prompt to validate"
    min_length: 50

  previous_validation_results:
    type: array
    required: false
    description: "Results from previous validation attempts (for tracking)"
    items:
      type: object

  attempt_number:
    type: integer
    required: false
    minimum: 1
    maximum: 3
    default: 1
    description: "Current validation attempt number"

output_contract:
  isValid:
    type: boolean
    required: true
    description: "Overall validation result (score >= threshold AND no errors)"

  qualityScore:
    type: number
    required: true
    minimum: 0
    maximum: 100
    description: "Calculated quality score"

  checks:
    type: array
    required: true
    description: "Individual validation check results"
    items:
      type: object
      properties:
        rule_id: {type: string}
        status: {enum: [pass, fail]}
        message: {type: string}
        severity: {enum: [error, warning, info]}
        section: {type: string}
        score_impact: {type: number}

  feedback:
    type: array
    required: true
    description: "Actionable feedback for refinement"
    items:
      type: string

  recommendations:
    type: array
    required: false
    description: "Specific improvement suggestions"
    items:
      type: string

  scoreBreakdown:
    type: object
    required: false
    properties:
      structural: {type: number}
      completeness: {type: number}
      quality: {type: number}
      bonuses: {type: number}
      penalties: {type: number}

  examplesAnalysis:
    type: object
    required: false
    properties:
      good_examples_found: {type: integer}
      bad_examples_found: {type: integer}
      examples_quality_score: {type: number}

  contextValidation:
    type: object
    required: false
    description: "Validation of input/context specifications (NEW)"
    properties:
      input_specification_present: {type: boolean}
      context_requirements_present: {type: boolean}
      required_inputs_count: {type: integer}
      context_sources_count: {type: integer}
      glean_integrations: {type: array}
      validation_issues: {type: array}

glean_integrations:
  - type: mcp_server
    server_path: "prompt-engineering"
    tool_name: "validate_prompt_quality"
    description: "MCP tool binding for this agent"

  - type: document_store
    usage: "Load validation rules and examples"
    query: "app:workflow-orchestration type:VALIDATION_RULE"
    filter: "prompt-generation"

configuration:
  model:
    name: "claude-sonnet-4"
    temperature: 0
    max_tokens: 2000
    top_p: 1.0

  instruction_source: "../../workflow-orchestration/workflows/prompt-generation/stages/02-validate-quality/instructions.md"

  validation_rules_source: "../../workflow-orchestration/workflows/prompt-generation/stages/02-validate-quality/validation-rules.json"

  examples_source: "../../workflow-orchestration/workflows/prompt-generation/stages/02-validate-quality/examples/"

  global_examples_source: "../../workflow-orchestration/global/examples/"

  global_standards_source: "../../workflow-orchestration/global/config/validation-standards.json"

  core_prompt_template: "validation-logic.xml"

  system_instructions: |
    You are a prompt quality validator specializing in XML-structured prompts.

    VALIDATION PHASES:
    1. Structural Validation (35%)
       - XML well-formed, required sections, tag hierarchy, naming

    2. Completeness Validation (30%)
       - Section content, examples quality, instructions
       - Input specification present (if applicable)
       - Context requirements present (if applicable)

    3. Quality Validation (25%)
       - Clarity, examples effectiveness, constraints, coherence

    4. Context Quality Validation (10%) [NEW]
       - Required inputs defined with descriptions
       - Input types and sources specified
       - Glean queries valid and accessible
       - Context sources appropriate for task

    Follow validation criteria from: {validation_rules_source}
    Compare against examples from: {examples_source} and {global_examples_source}

    Calculate weighted quality score (0-100) and provide specific recommendations
    if score is below threshold (90).

    Output a ValidationResult object with all required fields including contextValidation.

scoring:
  success_threshold: 90
  base_score: 100
  error_penalty: 20
  warning_penalty: 5
  info_penalty: 0
  bonus_per_extra_good_example: 2
  bonus_per_extra_bad_example: 2
  max_total_bonus: 10

  weights:
    structural: 0.35
    completeness: 0.30
    quality: 0.25
    context_quality: 0.10

  context_penalties:
    missing_input_specification: -15
    no_required_inputs: -5
    invalid_glean_queries: -10
    missing_input_descriptions: -5

validation_checks:
  structural:
    - xml_well_formed
    - required_sections_present
    - tag_hierarchy
    - naming_convention

  completeness:
    - section_content
    - examples_quality
    - instructions_structure
    - input_specification_present
    - context_requirements_present

  quality:
    - clarity_and_specificity
    - examples_effectiveness
    - constraints_and_validation
    - overall_coherence

  context_quality:
    - required_inputs_defined
    - input_descriptions_clear
    - glean_queries_valid
    - context_sources_accessible

retry_policy:
  max_attempts: 3
  backoff_strategy: "none"
  note: "Retry handled by workflow orchestration, not agent"

feedback_generation:
  enabled: true
  template_based: true
  include_error_fixes: true
  include_warning_improvements: true
  include_recommendations: true
  reference_examples: true
  max_feedback_items: 10
  prioritize_by_severity: true

constraints:
  - no_write_actions
  - no_hitl
  - read_only_operations
  - strict_validation_mode

performance:
  expected_latency_ms: 2000
  max_latency_ms: 60000
  cache_enabled: false

tags:
  - prompt-engineering
  - quality-validation
  - staged-validation
  - agent-collaboration
